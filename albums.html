<!DOCTYPE html>
<html class="fullscreen">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
<link rel="icon" type="image/png" sizes="32x32" href="img/small-icon.png">
<link rel="shortcut icon" href="img/small-icon.png" type="image/png">
<link rel="apple-touch-icon" href="img/apple_icons_57x57.png">
<link rel="apple-touch-icon" sizes="72x72" href="img/apple_icons_72x72.png">
<link rel="apple-touch-icon" sizes="114x114" href="img/apple_icons_114x114.png">
<title>Code Ninjas Photo Gallery</title>
<link href="https://fonts.googleapis.com/css?family=Roboto:400,700,400italic" rel="stylesheet" type="text/css">
<link href="https://fonts.googleapis.com/css?family=Muli" rel="stylesheet" type="text/css">
<link rel="stylesheet" href="css/theme.css" type="text/css" media="all" />
<link rel="stylesheet" href="css/responsive.css" type="text/css" media="all" />
<link rel="stylesheet" href="css/custom.css" type="text/css" media="all" />
</head>
<body>
	<header class="main_header">
    	<div class="header_scroll">
            <div class="header_wrapper">
            	<a href="index.html" class="logo"><img src="img/logo-white-outline.png" alt="" class="logo_def"><img src="img/logo-white-outline.png" alt="" class="logo_retina"></a>                
                <nav>
                	<div class="menu-main-menu-container">
                    	<ul id="menu-main-menu" class="menu">
                        	<li>
                            	<a href="index.html"><span>Home</span></a>                            
                            </li>
                            
                            <li class="current-menu-item menu-item-has-children">
                            	<a href="albums.html"><span>Albums</span></a>
                                <ul class="sub-menu" id="albums-dropdown">
                                    <!-- Albums will be dynamically loaded here -->
                                </ul>
                            </li>
                        </ul>                    
                    </div>
                </nav>                
            </div><!-- Header Wrapper -->
            <div class="footer_wrapper">            
                <div class="socials_wrapper">
                    <ul class="socials_list">
                    	<li><a class="ico_social_facebook" target="_blank" href="https://www.facebook.com/CodeNinjasLibertyville/" title="Facebook"></a></li>
                        <li><a class="ico_social_instagram" target="_blank" href="https://www.instagram.com/codeninjas/?hl=en" title="Instagram"></a></li>
                        <li><a class="ico_social_codeninjas" target="_blank" href="https://www.codeninjas.com/" title="Code Ninjas"><img src="img/small-icon.png" alt="Code Ninjas"></a></li>
                    </ul>
                </div>
                <div class="copyright">Copyright &copy; Code Ninjas.<br>All Rights Reserved</div>
            </div><!-- footer_wrapper -->
    	</div>
	</header>
    
    <div class="fullscreen_block hided" style="display: none;">
        <div class="fs_blog_module fw_port_module sorting_block">
            <!-- Content will be dynamically loaded by JavaScript -->
        </div>
    </div>
    
    <div class="custom_bg img_bg def_bg"></div>
    
    <script type="text/javascript" src="js/jquery.min.js"></script>
	<script type="text/javascript" src="js/jquery-ui.min.js"></script>    
    <script type="text/javascript" src="js/modules.js"></script>
	<script type="text/javascript" src="js/theme.js"></script>
    <script>
    	jQuery(document).ready(function ($) {
			"use strict";
			
			// Lock header scroll position during loading to prevent shifting
			var $headerScroll = jQuery('.header_scroll');
			var savedScrollTop = 0;
			if ($headerScroll.length && $headerScroll.data('jsp')) {
				savedScrollTop = $headerScroll.data('jsp').getContentPositionY();
			}
			
			jQuery('.filter_toggler').click(function(){
				jQuery('.optionset').slideToggle(300);
				jQuery('.filter_toggler').toggleClass('toggled');
			});
			if (window_w < 760) {
				jQuery('.optionset').slideToggle(1);
				jQuery('.filter_toggler').toggleClass('toggled');							
			}
			
			jQuery('.custom_bg').remove();
            port_setup();
            
            // Restore scroll position after a brief delay to prevent shifting
            setTimeout(function() {
				if ($headerScroll.length && $headerScroll.data('jsp')) {
					$headerScroll.data('jsp').scrollToY(savedScrollTop, false);
				}
			}, 100);
		});
		jQuery(window).load(function($){
			"use strict";
            port_setup();
        });
        jQuery(window).resize(function($){
			"use strict";
            port_setup();
        });
        function port_setup() {
			"use strict";
            jQuery('.fw-portPreview-content').each(function(){
                jQuery(this).css('margin-top', -1*jQuery(this).height()/2+'px');
            });
        }	
        
        window.addEventListener('DOMContentLoaded', function() {
            // Lock header scroll position to prevent shifting during load
            var $headerScroll = jQuery('.header_scroll');
            var savedScrollTop = null;
            if ($headerScroll.length && $headerScroll.data('jsp')) {
                savedScrollTop = $headerScroll.data('jsp').getContentPositionY();
            }
            
            // Hide existing template content and show loading skeleton
            var $fullscreenBlock = jQuery('.fullscreen_block');
            var $grid = jQuery('.fs_blog_module');
            
            // Show the fullscreen block and grid immediately (they're hidden by CSS)
            $fullscreenBlock.css({display: 'block', opacity: '0', visibility: 'visible'});
            $grid.empty();
            showLoadingSkeleton($grid);
            
            // Fade in the skeleton
            setTimeout(function() {
                $fullscreenBlock.css('opacity', '1');
                // Restore scroll position if it was saved
                if (savedScrollTop !== null && $headerScroll.length && $headerScroll.data('jsp')) {
                    $headerScroll.data('jsp').scrollToY(savedScrollTop, false);
                }
            }, 50);
            
            // Use PHP endpoint (works on FastComet and most shared hosting)
            const apiUrl = './api/airtable.php?table=albums';
            
            // Fetch data from our secure proxy
            fetch(apiUrl)
            .then(res => {
                if (!res.ok) {
                    throw new Error(`HTTP error! status: ${res.status}`);
                }
                console.log('Airtable HTTP status:', res.status);
                return res.json();
            })
           .then(data => {
                console.log('Airtable data:', data);
                buildAlbums(data);
                // Restore scroll position after content loads
                if (savedScrollTop !== null && $headerScroll.length && $headerScroll.data('jsp')) {
                    setTimeout(function() {
                        $headerScroll.data('jsp').scrollToY(savedScrollTop, false);
                    }, 100);
                }
            })
            .catch(error => {
                console.error('Airtable fetch error:', error);
            });
        });
       
        function showLoadingSkeleton($grid) {
            // Create 12 skeleton loader boxes
            for (var i = 0; i < 12; i++) {
                var skeletonHtml = 
                    '<div class="blogpost_preview_fw fw-portPreview element cities skeleton-loader">' +
                        '<div class="fw-portPreview-wrapper mas_style1 pr40 pb40">' +
                            '<div class="skeleton-box"></div>' +
                        '</div>' +
                    '</div>';
                $grid.append(skeletonHtml);
            }
        }

        function buildAlbums (data)
        {
            var $fullscreenBlock = jQuery('.fullscreen_block');
            var $grid = jQuery('.fs_blog_module');
            $grid.empty();

            if(!data || !data.records || !Array.isArray(data.records))
        {
            console.error('no records found in data');
            return;
        }

        for(var i=0; i<data.records.length; i++)
    {
        var record = data.records[i];
        if (record.fields.Published !== true)
    {
        continue; // Skip unpublished records
    }
        var attachments = record.fields && record.fields.Photo || [];
        var att = attachments[0] || {};
        var title = record.fields && record.fields.Title || 'Untitled Album';
        var imageUrl;
        if (att.thumbnails && att.thumbnails.large && att.thumbnails.large.url)
    {
        imageUrl = att.thumbnails.large.url;
    
    }
    else
    {
      imageUrl = att.url;  
    }
    var albumID = record.id || '';
    var htmlItem =
        '<div class="blogpost_preview_fw fw-portPreview element cities">' +
            '<div class="fw-portPreview-wrapper mas_style1 pr40 pb40">' +
                '<a href="photo_grid.html?album=' + encodeURIComponent(albumID) + '">' +
                    '<img src="' +imageUrl+ '" alt="" class="fw_featured_image" width="540">' +
                    '<div class="fw-portPreview-fadder"></div>' +
                    '<div class="fw-portPreview-content">' +
                        '<h2 class="fw-portPreview-title">'+title+'</h2>' +
                    '</div>' +
                '</a>' +
            '</div>' +
        '</div>';
        var $item = jQuery(htmlItem);
        $grid.append($item);
    } 
        }

        
        
        jQuery(document).ready(function ($) {
			"use strict";
			jQuery('.custom_bg').remove();            
		});
	</script>
    <script>
        // Load albums dynamically into dropdown menu
        (function() {
            const apiUrl = './api/airtable.php?table=albums';
            fetch(apiUrl)
                .then(res => {
                    if (!res.ok) {
                        throw new Error(`HTTP error! status: ${res.status}`);
                    }
                    return res.json();
                })
                .then(data => {
                    if (data && data.records && Array.isArray(data.records)) {
                        // Build dropdown menu items from albums
                        var $dropdown = jQuery('#albums-dropdown');
                        if ($dropdown.length) {
                            $dropdown.empty();
                            
                            // Add all albums
                            for (var i = 0; i < data.records.length; i++) {
                                var record = data.records[i];
                                if (record.fields.Published !== true) continue;
                                
                                var albumID = record.id || '';
                                var albumName = record.fields.Title || 'Untitled Album';
                                var $li = jQuery('<li><a href="photo_grid.html?album=' + encodeURIComponent(albumID) + '"><span>' + albumName + '</span></a></li>');
                                $dropdown.append($li);
                            }
                        }
                    }
                })
                .catch(error => {
                    console.error('Error loading albums for dropdown:', error);
                });
        })();
    </script>
    <script>
        // Handle click on Albums arrow to toggle dropdown
        jQuery(document).ready(function($) {
            $('.main_header nav ul.menu > li.menu-item-has-children > a').on('click', function(e) {
                var $link = $(this);
                var $parent = $link.parent('li');
                var linkOffset = $link.offset();
                var linkWidth = $link.outerWidth();
                var clickX = e.pageX - linkOffset.left;
                
                // If click is in the arrow area (right 20px), toggle dropdown
                if (clickX > linkWidth - 20) {
                    e.preventDefault();
                    e.stopPropagation();
                    
                    // Toggle active class
                    $parent.toggleClass('active');
                    
                    // Close other dropdowns
                    $('.main_header nav ul.menu > li.menu-item-has-children').not($parent).removeClass('active');
                }
                // Otherwise, allow normal link navigation to albums.html
            });
            
            // Close dropdown when clicking outside
            $(document).on('click', function(e) {
                if (!$(e.target).closest('.main_header nav ul.menu > li.menu-item-has-children').length) {
                    $('.main_header nav ul.menu > li.menu-item-has-children').removeClass('active');
                }
            });
        });
    </script>
    <script type="text/javascript" src="js/jquery.isotope.min.js"></script>
</body>
</html>