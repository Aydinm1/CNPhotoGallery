<!DOCTYPE html>
<html class="fullscreen">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
<link rel="shortcut icon" href="img/favicon.ico" type="image/x-icon">
<link rel="apple-touch-icon" href="img/apple_icons_57x57.png">
<link rel="apple-touch-icon" sizes="72x72" href="img/apple_icons_72x72.png">
<link rel="apple-touch-icon" sizes="114x114" href="img/apple_icons_114x114.png">
<title>Code Ninjas Photo Gallery</title>
<link href="https://fonts.googleapis.com/css?family=Roboto:400,700,400italic" rel="stylesheet" type="text/css">
<link href="https://fonts.googleapis.com/css?family=Muli" rel="stylesheet" type="text/css">
<link rel="stylesheet" href="css/theme.css" type="text/css" media="all" />
<link rel="stylesheet" href="css/responsive.css" type="text/css" media="all" />
<link rel="stylesheet" href="css/custom.css" type="text/css" media="all" />
</head>
<body>
	<header class="main_header">
    	<div class="header_scroll">
            <div class="header_wrapper">
            	<a href="index.html" class="logo"><img src="img/logo-white-outline.png" alt="" class="logo_def"><img src="img/logo-white-outline.png" alt="" class="logo_retina"></a>                
                <nav>
                	<div class="menu-main-menu-container">
                    	<ul id="menu-main-menu" class="menu">
                        	<li >
                            	<a href="index.html"><span>Home</span></a>                             
                            </li>
                            <li class="menu-item-has-children">
                            	<a href="albums.html"><span>Albums</span></a>
                                <ul class="sub-menu" id="albums-dropdown">
                                    <!-- Albums will be dynamically loaded here -->
                                </ul>
                            </li>
                        </ul>                    
                    </div>
                </nav>                
                            
            </div><!-- Header Wrapper -->
            <div class="footer_wrapper">            
                <div class="socials_wrapper">
                    <ul class="socials_list">
                    	<li><a class="ico_social_facebook" target="_blank" href="https://www.facebook.com/CodeNinjasLibertyville/" title="Facebook"></a></li>
                        <li><a class="ico_social_instagram" target="_blank" href="https://www.instagram.com/codeninjas/?hl=en" title="Instagram"></a></li>
                        <li><a class="ico_social_codeninjas" target="_blank" href="https://www.codeninjas.com/" title="Code Ninjas"><img src="img/small-icon.png" alt="Code Ninjas"></a></li>
                    </ul>
                </div>
                <div class="copyright">Copyright &copy; Code Ninjas.<br>All Rights Reserved</div>
            </div><!-- footer_wrapper -->
    	</div>
	</header>
    
	<a href="javascript:void(0)" class="control_toggle"></a>
    
    <div class="custom_bg img_bg def_bg"></div>
    
    <script type="text/javascript" src="js/jquery.min.js"></script>
	<script type="text/javascript" src="js/jquery-ui.min.js"></script>    
    <script type="text/javascript" src="js/modules.js"></script>
	<script type="text/javascript" src="js/theme.js"></script>
	<script>
		// Build fullscreen slider from Airtable via the server proxy.
		(function(){
			var apiUrl = './api/airtable.php';

			function buildSlidesFromData(data) {
				var slides = [];
				if (!data || !Array.isArray(data.records)) return slides;

				for (var i = 0; i < data.records.length; i++) {
					var rec = data.records[i];
					var f = rec.fields || {};
					// Only include published items
					if (f.Published !== true) continue;

					// Require an explicit 'Add to Home Page' checkbox (hand-selected)
					// Keep fallbacks for older field names if present
					var addToHome = (f['Add to Home Page'] === true) || (f.Featured === true) || (f.ShowOnHome === true) || (f.Home === true);
					if (!addToHome) continue;

					var type = (String(f.Type || '').toLowerCase());

					// Get photo thumbnail or image
					var imageUrl = '';
					if (Array.isArray(f.Photo) && f.Photo[0]) {
						var p = f.Photo[0];
						if (p.thumbnails && p.thumbnails.large && p.thumbnails.large.url) imageUrl = p.thumbnails.large.url;
						else if (p.url) imageUrl = p.url;
					}

					// Get video attachment if present
					var videoUrl = '';
					var videoAtt = (Array.isArray(f.Video) && f.Video[0]) ? f.Video[0] : null;
					if (videoAtt) {
						videoUrl = videoAtt.url || '';
					}

					// Normalize into the fs_gallery slide format
					if (type === 'video' && videoUrl) {
						// Detect YouTube and Vimeo links and extract IDs
						var ytMatch = videoUrl.match(/(?:youtube\.com\/(?:watch\?v=|embed\/)|youtu\.be\/)([A-Za-z0-9_-]{6,})/i);
						var vimeoMatch = videoUrl.match(/vimeo\.com\/(?:video\/)?(\d+)/i);
						if (ytMatch && ytMatch[1]) {
							slides.push({
								type: 'youtube',
								src: ytMatch[1],
								thmb: imageUrl || '',
								title: f.Title || f.Name || '',
								description: f.Description || f.Caption || ''
							});
						} else if (vimeoMatch && vimeoMatch[1]) {
							slides.push({
								type: 'vimeo',
								src: vimeoMatch[1],
								uniqid: 'v' + (new Date().getTime()) + '_' + i,
								thmb: imageUrl || '',
								title: f.Title || f.Name || '',
								description: f.Description || f.Caption || ''
							});
						} else if (videoAtt && ((videoAtt.type && /^video\//i.test(videoAtt.type)) || (videoAtt.filename && videoAtt.filename.match(/\.mp4$/i)))) {
							// Attachment metadata indicates a video (likely MP4) even if URL lacks extension
							slides.push({
								type: 'mp4',
								src: videoUrl,
								thmb: imageUrl || '',
								title: f.Title || f.Name || '',
								description: f.Description || f.Caption || ''
							});
						} else if (videoUrl.match(/\.mp4($|\?)/i)) {
							// Fallback: URL contains .mp4
							slides.push({
								type: 'mp4',
								src: videoUrl,
								thmb: imageUrl || '',
								title: f.Title || f.Name || '',
								description: f.Description || f.Caption || ''
							});
						} else {
							// Unknown video host â€” log attachment for debugging and skip to avoid broken iframes
							console.warn('Skipping unsupported video URL for record', rec.id, videoUrl, videoAtt);
						}
					} else if (type === 'photo' && imageUrl) {
						slides.push({
							type: 'image',
							image: imageUrl,
							thmb: imageUrl,
							title: f.Title || f.Name || '',
							description: f.Description || f.Caption || ''
						});
					}
				}
				return slides;
			}

			// Fetch Airtable and initialize slider
			fetch(apiUrl).then(function(res){
				if (!res.ok) throw new Error('HTTP ' + res.status);
				return res.json();
			}).then(function(data){
				var slides = buildSlidesFromData(data);
				// Expose built slides for debugging
				window.homeSlides = slides;
				console.log('homeSlides:', slides);
				// Fallback: if no slides found, leave default static set (do nothing)
				if (!slides || slides.length === 0) {
					console.warn('No featured slides found in Airtable. Slider will use static set.');
				}

				jQuery(document).ready(function(){
					"use strict";
					jQuery('html').addClass('hasPag');
					jQuery('.custom_bg').remove();
					jQuery('body').fs_gallery({
						fx: 'fade', /*fade, zoom, slide_left, slide_right, slide_top, slide_bottom*/
						fit: 'no_fit',
						slide_time: 3300, /*This time must be < then time in css*/
						autoplay: 1,
						show_controls: 1,
						slides: (slides && slides.length > 0 ? slides : window.gallery_set || [])
					});

					jQuery('.fs_share').click(function(){
						jQuery('.fs_fadder').removeClass('hided');
						jQuery('.fs_sharing_wrapper').removeClass('hided');
						jQuery('.fs_share_close').removeClass('hided');
					});
					jQuery('.fs_share_close').click(function(){
						jQuery('.fs_fadder').addClass('hided');
						jQuery('.fs_sharing_wrapper').addClass('hided');
						jQuery('.fs_share_close').addClass('hided');
					});
					jQuery('.fs_fadder').click(function(){
						jQuery('.fs_fadder').addClass('hided');
						jQuery('.fs_sharing_wrapper').addClass('hided');
						jQuery('.fs_share_close').addClass('hided');
					});

					jQuery('.fs_controls').addClass('up_me');
					jQuery('.fs_title_wrapper ').addClass('up_me');
					jQuery('.close_controls').click(function(){
						if (jQuery(this).hasClass('open_controls')) {
							jQuery('.fs_controls').removeClass('hide_me');
							jQuery('.fs_title_wrapper ').removeClass('hide_me');
							jQuery('.fs_thmb_viewport').removeClass('hide_me');
							jQuery('header.main_header').removeClass('hide_me');
							jQuery(this).removeClass('open_controls');
						} else {        
							jQuery('header.main_header').addClass('hide_me');
							jQuery('.fs_controls').addClass('hide_me');
							jQuery('.fs_title_wrapper ').addClass('hide_me');
							jQuery('.fs_thmb_viewport').addClass('hide_me');
							jQuery(this).addClass('open_controls');
						}
					});
					jQuery('.main_header').removeClass('hided');
					jQuery('html').addClass('single-gallery');
					jQuery('.control_toggle').click(function(){
						jQuery('html').toggleClass('hide_controls');
					});
				});
			}).catch(function(err){
				console.error('Failed to load Airtable slides:', err);
				// initialize with fallback static set if available
				jQuery(document).ready(function(){
					jQuery('html').addClass('hasPag');
					jQuery('.custom_bg').remove();
					jQuery('body').fs_gallery({
						fx: 'fade',
						fit: 'no_fit',
						slide_time: 3300,
						autoplay: 1,
						show_controls: 1,
						slides: window.gallery_set || []
					});
				});
			});
		})();
			jQuery('.fs_share').click(function(){
				jQuery('.fs_fadder').removeClass('hided');
				jQuery('.fs_sharing_wrapper').removeClass('hided');
				jQuery('.fs_share_close').removeClass('hided');
			});
			jQuery('.fs_share_close').click(function(){
				jQuery('.fs_fadder').addClass('hided');
				jQuery('.fs_sharing_wrapper').addClass('hided');
				jQuery('.fs_share_close').addClass('hided');
			});
			jQuery('.fs_fadder').click(function(){
				jQuery('.fs_fadder').addClass('hided');
				jQuery('.fs_sharing_wrapper').addClass('hided');
				jQuery('.fs_share_close').addClass('hided');
			});
	
			jQuery('.fs_controls').addClass('up_me');
			jQuery('.fs_title_wrapper ').addClass('up_me');
		
			jQuery('.close_controls').click(function(){
				if (jQuery(this).hasClass('open_controls')) {
					jQuery('.fs_controls').removeClass('hide_me');
					jQuery('.fs_title_wrapper ').removeClass('hide_me');
					jQuery('.fs_thmb_viewport').removeClass('hide_me');
					jQuery('header.main_header').removeClass('hide_me');
					jQuery(this).removeClass('open_controls');
				} else {		
					jQuery('header.main_header').addClass('hide_me');
					jQuery('.fs_controls').addClass('hide_me');
					jQuery('.fs_title_wrapper ').addClass('hide_me');
					jQuery('.fs_thmb_viewport').addClass('hide_me');
					jQuery(this).addClass('open_controls');
				}
			});
			
			jQuery('.main_header').removeClass('hided');
			jQuery('html').addClass('single-gallery');
			jQuery('.control_toggle').click(function(){
				jQuery('html').toggleClass('hide_controls');
			});			
	</script>
    <script>
        // Load albums dynamically into dropdown menu
        (function() {
            const apiUrl = './api/airtable.php?table=albums';
            fetch(apiUrl)
                .then(res => {
                    if (!res.ok) {
                        throw new Error(`HTTP error! status: ${res.status}`);
                    }
                    return res.json();
                })
                .then(data => {
                    if (data && data.records && Array.isArray(data.records)) {
                        // Build dropdown menu items from albums
                        var $dropdown = jQuery('#albums-dropdown');
                        if ($dropdown.length) {
                            $dropdown.empty();
                            
                            // Add all albums
                            for (var i = 0; i < data.records.length; i++) {
                                var record = data.records[i];
                                if (record.fields.Published !== true) continue;
                                
                                var albumID = record.id || '';
                                var albumName = record.fields.Title || 'Untitled Album';
                                var $li = jQuery('<li><a href="photo_grid.html?album=' + encodeURIComponent(albumID) + '"><span>' + albumName + '</span></a></li>');
                                $dropdown.append($li);
                            }
                        }
                    }
                })
                .catch(error => {
                    console.error('Error loading albums for dropdown:', error);
                });
        })();
    </script>
    <script>
        // Handle click on Albums arrow to toggle dropdown
        jQuery(document).ready(function($) {
            $('.main_header nav ul.menu > li.menu-item-has-children > a').on('click', function(e) {
                var $link = $(this);
                var $parent = $link.parent('li');
                var linkOffset = $link.offset();
                var linkWidth = $link.outerWidth();
                var clickX = e.pageX - linkOffset.left;
                
                // If click is in the arrow area (right 20px), toggle dropdown
                if (clickX > linkWidth - 20) {
                    e.preventDefault();
                    e.stopPropagation();
                    
                    // Toggle active class
                    $parent.toggleClass('active');
                    
                    // Close other dropdowns
                    $('.main_header nav ul.menu > li.menu-item-has-children').not($parent).removeClass('active');
                }
                // Otherwise, allow normal link navigation to albums.html
            });
            
            // Close dropdown when clicking outside
            $(document).on('click', function(e) {
                if (!$(e.target).closest('.main_header nav ul.menu > li.menu-item-has-children').length) {
                    $('.main_header nav ul.menu > li.menu-item-has-children').removeClass('active');
                }
            });
        });
    </script>
    <script type="text/javascript" src="js/fs_gallery.js"></script>
</body>
</html>